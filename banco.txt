create table fornecedores(
	cod_fornecedor serial primary key,
	empresa varchar(30) not null,
	tipo varchar(20) not null,
	refe varchar(20) not null
);

create table produtos(
	cod_produto serial primary key,
	nome varchar(30) not null,
	quantidade integer not null,
	valor numeric(10,2),
	refe varchar(30),
	fk_forne integer,
	constraint Fk_forne foreign key (Fk_forne) references fornecedores (cod_fornecedor)  
);

create table cliente(
  cod_pes serial primary key,
  nome varchar(30),
  cpf varchar(20),
  senha varchar(30),
  data_nasc date
);

create table cli_prod(
	cod serial primary key,
	Fk_cliente integer,
	Fk_produto integer,
	data_compra date,
	quantidade integer,
	valor_tot numeric(15,2),
	constraint Fk_cliente foreign key (Fk_cliente) references cliente(cod_cliente),  
	constraint Fk_produto foreign key (Fk_produto) references fornecedores(cod_fornecedor)  
);

create or replace function inserir_cliente(cod integer, nom varchar, cp varchar, sen varchar, data_nas date) returns void as
$$
begin
	insert into cliente(cod_pes, nome, cpf, senha, data_nasc) values(cod, nom, cp, sen, data_nas);

end;
$$
language plpgsql;

select inserir_cliente(2, 'Maria', '76786', '123', '01/01/2000');


drop table produtos;

insert into produtos(nome, quantidade, valor, refe) values('Celular', 14, 600.90, '12345');

create or replace function inserir_produtos(nome varchar, qtd integer, vlr numeric, refe varchar, forn integer) returns void as
$$
begin
	insert into produtos(nome, quantidade, valor, refe, Fk_forne) values(nome, qtd, vlr, refe, forn);

end;
$$
language plpgsql;

create or replace function updade_produtos(nom varchar, qtd integer, vlr numeric, referencia varchar, id integer, forn integer) returns void as
$$
begin
	update produtos
	set nome = nom, quantidade = qtd, valor = vlr, refe = referencia, Fk_forne = forn
	where cod_produto = id;

end;
$$
language plpgsql;


DROP FUNCTION inserir_produtos(character varying,integer,numeric,character varying)
DROP FUNCTION updade_produtos(character varying,integer,numeric,character varying,integer)

select inserir_produtos('Celular Nokia', 29, 800.90, '128845',1);


create or replace function delete_produtos(id integer) returns void as
$$
begin
	delete from produtos
	where cod_produto = id;

end;
$$
language plpgsql;


select delete_produtos(2)


create or replace function inserir_fornecedores(empre varchar, tipo varchar, referencia varchar) returns void as
$$
begin
	insert into fornecedores(empresa, tipo, refe) values(empre, tipo, referencia);

end;
$$
language plpgsql;

select inserir_fornecedores('Havaianas', 'Chinelo', 'Joï¿½o');

create or replace function updade_fornecedores(empre varchar, tip varchar, referencia varchar, id integer) returns void as
$$
begin
	update fornecedores
	set empresa = empre, tipo = tip, refe = referencia
	where cod_fornecedor = id;

end;
$$
language plpgsql;


select updade_fornecedores('ALPRAGATAS','Chinelo', 'HAVAIANAS', 1);

create or replace function inserir_compra(Fk_cli integer, Fk_prod integer, data_comp date, quantidade integer, vlr_tot numeric) returns void as
$$
begin
	insert into cli_prod(Fk_cliente, Fk_produto, data_compra, quantidade, valor_tot)
	values(Fk_cli, Fk_prod, data_comp, quantidade, vlr_tot);

end;
$$
language plpgsql;
